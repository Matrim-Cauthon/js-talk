<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=PT+Sans:400,400italic);
      @import url(https://cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css);

      body {
       font-family: 'PT Sans';
      }
      .remark-slide-content{
        background: #5C5352;
      }
      h1, h2, h3 {
        font-family: 'PT Sans';
        font-weight: lighter;
      }
      .remark-code, .remark-inline-code { font-family: 'Hack'; }

      .inverse {
        background: #0C2342;
        color: #2590C3;
      }


    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle, inverse

# Lessons Learned Making an Open-Source Plugin Framework

### a.k.a. How to Modernize Your JS for Much Success

---

class: center, middle, inverse

# What Framework?

![XSplit JS Logo](./img_logo.png)


???

What is XSplit?

What is a plugin?

---

class: center, middle

![ExtraLife](./extralife_tracker.png)

![TwitchChat](./twitch_chat.png)

???

What is this framework? we're not talking about a jQuery plugin

How did we make the plugin framework?

---

class: center, middle, inverse

# Lesson 1: Don't be scared of new things

???

TypeScript: support for type checking, for next-generation JS

built everything from scratch

bleeding-edge has pros and cons, sometimes you should take the plunge

---

class: middle

```typescript
export class File implements Addable {
  private _path: string;

  addToScene(): Promise<boolean> {
    return new Promise(resolve => {
      iApp.callFunc('addfile', this._path).then(() => {
        resolve(true);
      });
    });
  }
}
```

---

class: center, middle, inverse

# Lesson 2: Be willing to accept changes in code

???

concept of code ownership can go too far

went through at least 3 iterations

refactor refactor refactor!

effect on user feedback?

---

class: center, middle, inverse

# Lesson 3: Committed to nonbreaking changes

???

emphasize that this is to be used not internally, but by other people

after version 1, ensure compatibility, non changing API

console.warn is a good thing

talk about semver. minor versions should simply deprecate, never break

---

class: center, middle, inverse

# Lesson 4: Always document your code

---

class: middle

```typescript
/**
 * return: Promise<Scene>
 *
 * Get a specific scene object given the scene number.
 *
 *
 * #### Usage
 *
 * ```javascript
 * var scene1;
 * Scene.getByIdAsync(1).then(function(scene) {
 *   scene1 = scene;
 * });
 * ``` ‚Å£
 */
static getByIdAsync(sceneNum: number): Promise<Scene> {
  return new Promise(resolve => {
    Scene._initializeScenePoolAsync().then(cnt => {
      resolve(Scene._scenePool[sceneNum - 1]);
    });
  });
}
```

???

descriptive docs, generated by dgeni

sample code

do not break encapsulation in your docs. users do not need to know all the little details

docs are also reflected in error messages

docs also contain recommended patterns in using framework

release notes!

---

class: center, middle, inverse

# Lesson 5: Make sure your code is tested

???

we test with Jasmine

continuous integration with Travis

useful when doing large refactoring

Travis build passed badge ;)

---

class: center

![Jasmine](./jasmine.png)

![Karma](./karma.png)

![Travis](./travis.png)

---

class: center, middle, inverse

# Lesson 6:  Automate repetitive tasks

???

things we automate: building (includes transpiling, bundling, minification), docgen, tests, version appending

things we want to automate: linting

---

class: middle

```javascript
gulp.task('browserify', function() {
    return browserify('./src/index.ts')
      .plugin('tsify', {
        target: 'ES5',
        declaration: true })
      .require('./src/index.ts', {expose: 'xjs'})
      .bundle()
      .pipe(source('xjs.js'))
      .pipe(gulp.dest('dist'));
  });
```

???

how we did it: gulp

how to do it now? grunt, npm scripts are also options

webpack building -> webpack 2 includes tree shaking

---

class: center, middle, inverse

# Lesson 7: Modernize your JavaScript for much success

---

class: middle

### Promises

```javascript
var xjs = require('xjs');

xjs.ready().then(xjs.Source.getCurrentSource)
  .then(function(source){
     return source.getSceneId();
  }).then(function(id){
    return xjs.Scene.getById(id)
  }).then(function(scene){
    return scene.getSources();
  }).then(function(items){
      var p;
      for (var i in items) {
        items[i].getName().then(function(name) {
          p = document.createElement('p');
          p.textContent = name;
          document.body.appendChild(p);
        });
      }
  });
```

???

Promises to avoid callback hell

---

class: middle

### Classes

```typescript
export class CameraDevice implements Addable {
  private _id: string;
  private _name: string;

  constructor(props?: {}) {
    this._id   = props['id'];
    this._name = props['name'];
  }
```

???

TypeScript: use ES2015 features

JS Classes

---

class: middle

`version.ts`
```javascript
export function getVersion(): string {
  let xbcPattern = /XSplit Broadcaster\s(.*?)\s?/;
  let xbcMatch = navigator.appVersion.match(xbcPattern);
  if (xbcMatch !== null) {
    return xbcMatch[1];
  } else {
    throw new Error('not loaded in XSplit Broadcaster');
  }
}

```

`item.ts`
```typescript
import {IItemLayout} from './ilayout'
import {minVersion, versionCompare, getVersion} from 'util/version'

export class Item implements IItemLayout {
  getSourceId(): Promise<string> {
      return new Promise((resolve, reject) => {
        if (versionCompare(getVersion()).is.lessThan(minVersion)) {
          // ...  
        }
      })
    }
}
```

???

Module system to have easier code structure 

---

class: center, middle, inverse

# Lesson 8: Learn from established patterns

---

class: middle

```javascript
var button = document.getElementById('openDialogButton');
button.addEventListener('click', function() {
  xjs.Dialog.createDialog('your.url/here.html')
  .setSize(500, 800)
  .setTitle('ThisDialogReturnsAString')
  .setBorderOptions(true, false)
  .setButtons(true, true)
  .show()
  .getResult().then(function(result) {
    document.getElementById('input').value = result;
  });
});
```

???

(in addition to making use of established libraries instead of reinventing the wheel)

Learn techniques from libraries and frameworks in the wild

Beautiful interface with a fluent interface with our method chaining: examples are with setting properties, or initializing a NewDialog

Beautiful code with coding standards. In addition to linting, use your text editor (.editorrc, Sublime margins + whitespace display settings)

suggest airbnb

---

class: center, middle, inverse

# Lesson 9: Have a vision for your project

???

Makes for a consistent API

Github issues might have unusual requests, make sure to know how to approach them

    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
